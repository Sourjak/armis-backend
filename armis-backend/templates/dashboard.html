<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ARMIS Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <h1>ARMIS Dashboard</h1>
        <nav>
            <a href="{{ url_for('dashboard') }}">Dashboard</a>
            <a href="{{ url_for('risk_analysis') }}">Risk Analysis</a>
        </nav>
    </header>
    <main>
        <section id="live-data">
            <h2>Live Sensor Data</h2>
            <div class="data-container">
                <p>Temperature: <span id="temp">--</span></p>
                <p>Humidity: <span id="humidity">--</span></p>
                <p>Soil: <span id="soil">--</span></p>
                <p>Rain: <span id="rain">--</span></p>
                <p>GPS: <span id="gps">--</span></p>
            </div>
        </section>
        <section id="charts">
            <h2>Graphs</h2>
            <canvas id="tempChart"></canvas>
            <canvas id="humidityChart"></canvas>
        </section>
    </main>

<script>
const tempData = [];
const humidityData = [];
const timeLabels = [];
const tempCtx = document.getElementById('tempChart').getContext('2d');
const humidityCtx = document.getElementById('humidityChart').getContext('2d');

const tempChart = new Chart(tempCtx, {
    type: 'line',
    data: { labels: timeLabels, datasets: [{ label: 'Temperature (Â°C)', data: tempData, borderColor: 'red', fill: false }] },
    options: { responsive: true }
});
const humidityChart = new Chart(humidityCtx, {
    type: 'line',
    data: { labels: timeLabels, datasets: [{ label: 'Humidity (%)', data: humidityData, borderColor: 'blue', fill: false }] },
    options: { responsive: true }
});

async function fetchData() {
    try {
        const res = await fetch('/data');
        const data = await res.json();
        if (data.Temp) document.getElementById('temp').innerText = data.Temp;
        if (data.Humidity) document.getElementById('humidity').innerText = data.Humidity;
        if (data.Soil) document.getElementById('soil').innerText = data.Soil;
        if (data.Rain) document.getElementById('rain').innerText = data.Rain;
        if (data.GPS) document.getElementById('gps').innerText = data.GPS;
        const now = new Date().toLocaleTimeString();
        timeLabels.push(now);
        tempData.push(parseFloat(data.Temp) || 0);
        humidityData.push(parseFloat(data.Humidity) || 0);
        if (timeLabels.length > 10) { timeLabels.shift(); tempData.shift(); humidityData.shift(); }
        tempChart.update();
        humidityChart.update();
    } catch(err) { console.error(err); }
}
setInterval(fetchData, 2000);
fetchData();
</script>
</body>
</html>
