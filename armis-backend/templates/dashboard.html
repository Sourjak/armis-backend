<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ARMIS Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <h1>ARMIS Dashboard</h1>
        <nav>
            <a href="{{ url_for('dashboard') }}">Dashboard</a>
            <a href="{{ url_for('risk_analysis') }}">Risk Analysis</a>
        </nav>
    </header>

    <main>
        <section id="live-data">
            <h2>Live Data</h2>
            <div class="data-cards">
                <div class="card">Temperature: <span id="temp">--</span></div>
                <div class="card">Humidity: <span id="humidity">--</span></div>
                <div class="card">Rain: <span id="rain">--</span></div>
                <div class="card">Soil: <span id="soil">--</span></div>
                <div class="card">GPS: <span id="gps">--</span></div>
            </div>
        </section>

        <section id="graphs">
            <canvas id="tempChart"></canvas>
            <canvas id="humidityChart"></canvas>
        </section>
    </main>

    <script>
        let tempData = [];
        let humidityData = [];
        let labels = [];

        const tempChartCtx = document.getElementById('tempChart').getContext('2d');
        const humidityChartCtx = document.getElementById('humidityChart').getContext('2d');

        const tempChart = new Chart(tempChartCtx, {
            type: 'line',
            data: { labels, datasets: [{ label: 'Temperature (Â°C)', data: tempData, borderColor: 'red', tension: 0.3 }] },
            options: { responsive: true, maintainAspectRatio: false }
        });

        const humidityChart = new Chart(humidityChartCtx, {
            type: 'line',
            data: { labels, datasets: [{ label: 'Humidity (%)', data: humidityData, borderColor: 'blue', tension: 0.3 }] },
            options: { responsive: true, maintainAspectRatio: false }
        });

        async function fetchData() {
            try {
                const response = await fetch('/data');
                const data = await response.json();
                
                if (!data.message) {
                    document.getElementById('temp').innerText = data.Temp || '--';
                    document.getElementById('humidity').innerText = data.Humidity || '--';
                    document.getElementById('rain').innerText = data.Rain || '--';
                    document.getElementById('soil').innerText = data.Soil || '--';
                    document.getElementById('gps').innerText = data.GPS || '--';

                    const timeLabel = new Date().toLocaleTimeString();
                    labels.push(timeLabel);
                    tempData.push(parseFloat(data.Temp) || 0);
                    humidityData.push(parseFloat(data.Humidity) || 0);

                    if (labels.length > 20) {
                        labels.shift();
                        tempData.shift();
                        humidityData.shift();
                    }

                    tempChart.update();
                    humidityChart.update();
                }
            } catch (err) {
                console.error("Error fetching data:", err);
            }
        }

        setInterval(fetchData, 2000);
        fetchData();
    </script>
</body>
</html>
