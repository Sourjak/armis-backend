<!DOCTYPE html>
<html>
<head>
    <title>Risk Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body style="font-family: Arial;">

    <h1>Risk Analysis</h1>

    <canvas id="riskChart" width="400" height="200"></canvas>

    <h2 id="riskText">Loading risk...</h2>

    <!-- Trigger Alert Button -->
    <button onclick="triggerAlert()" 
            style="background-color:red;color:white;padding:10px 20px;border:none;border-radius:5px;">
        ðŸš¨ Trigger Alert
    </button>

    <script>
        let ctx = document.getElementById("riskChart").getContext("2d");
        let chart = new Chart(ctx, {
            type: "doughnut",
            data: {
                labels: ["Risk %", "Safe %"],
                datasets: [{
                    data: [0, 100],
                    backgroundColor: ["red", "green"]
                }]
            }
        });

        async function fetchRisk() {
            let res = await fetch("/risk-data");
            let data = await res.json();

            chart.data.datasets[0].data = [data.risk_percent, 100 - data.risk_percent];
            chart.update();

            document.getElementById("riskText").innerText = 
                `Risk Level: ${data.risk_level} (${data.risk_percent}%)\nMain Factor: ${data.main_factor}`;
        }

        async function triggerAlert() {
            let res = await fetch("/trigger-alert", {method: "POST"});
            let data = await res.json();
            alert(data.message);
        }

        setInterval(fetchRisk, 3000);
        fetchRisk();
    </script>

</body>
</html>
